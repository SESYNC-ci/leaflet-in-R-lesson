---
editor_options: 
  chunk_output_type: console
---

## Leaflet in shiny

Incorporating leaflet maps into [RShiny](https://shiny.rstudio.com/) applications allows for creating more customized interactivity using R code.

As you may have learned in the [Shiny lesson](https://cyberhelp.sesync.org/basic-Shiny-lesson/), the app comprises a *user interface* object that defines how it appears, and a *server* object that defines how it behaves. 

===

The ui and server interact through `*input` and `*output` objects such as input widgets, plots, buttons, tables, etc. Leaflet maps in Shiny are constructed with `renderLeaflet()` and displayed in the output using `leafletOutput()`.

![shinyarrows]({% include asset.html path="images/shiny-arrows.png" %})

===

To see how this works, we'll build a shiny app with a leaflet map, where one of the map layers is defined with a user-specified value from an input widget. See the app in action [here](https://shiny.sesync.org/apps/leaflet-in-R-shinydemo1/). 

Define an output object called `map` in the server function. 

```{r leaflet_shiny1, handout = 2, eval = FALSE}
  output$map <- renderLeaflet({
    leaflet() %>%
      addTiles(group = "OSM") %>%
      addProviderTiles(providers$NASAGIBS.ModisTerraTrueColorCR, group = "Modis",
                       options = providerTileOptions(time = "2018-01-05")) %>%
      setView(lng = -76.505206, lat = 38.9767231, zoom = 7) %>%
      addLayersControl(baseGroups = c("Modis", "OSM"),
                       options = layersControlOptions(collapsed = FALSE)
      )
  })
```

We wrap the leaflet map inside the `renderLeaflet()` function, using curly brackets `{}` around the expression.
We include two tile layers, OpenStreetMap and MODIS imagery, with layers control activated to 
allow the user to select which one to display.
{:.notes}

===

Define the ui to include the output called `"map"`. 

```{r leaflet_shiny2, handout = 2, eval = FALSE}
ui <- fluidPage(
  leafletOutput("map", height = 800)
)
```

===

Add a panel to the ui that will let users choose a calendar date. 

```{r leaflet_shiny3, handout = 2, eval = FALSE}
ui <- fluidPage(
    leafletOutput("map", height = 800),
      absolutePanel(top = 100, right = 10, draggable = TRUE,
              dateInput("dateinput", "Imagery Date", value = "2018-03-28"
                    )
))
```

The `dateInput()` function's first argument is the name of the input object
that is passed to the server function. We'll call it `"dateinput"`. The
next argument is the descriptive title seen by the user, and the `value` 
argument is the starting value before user input.
{:.notes}

===

Use the `dateinput` input object in the Provider Tiles layer.

```{r leaflet_shiny4, handout = 2, eval = FALSE}
 addProviderTiles(providers$NASAGIBS.ModisTerraTrueColorCR, group = "Modis",
                       options = providerTileOptions(time = input$dateinput))
```

Now, the MODIS tiles will be retrieved for a user-input day specified by
`providerTileOptions()`. The MODIS tile provider accepts an option called
`time` to which we pass the `dateinput` object from the list called `input`
that the server function gets from the ui.
{:.notes}